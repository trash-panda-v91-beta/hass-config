# Sofar G3 also HYD 5-20KTL-3PH

requests:
  - start: 0x0400
    end: 0x042E
    mb_functioncode: 0x03
  - start: 0x0480
    end: 0x04AF
    mb_functioncode: 0x03
  - start: 0x0580
    end: 0x058F
    mb_functioncode: 0x03
  - start: 0x0680
    end: 0x069B
    mb_functioncode: 0x03

parameters:
  - group: Inverter
    items:
      - name: "Device State"
        class: ""
        state_class: "measurement"
        uom: ""
        scale: 1
        rule: 1
        registers: [ 0x0404 ]
        isstr: true
        lookup:
          - key: 0
            value: "waiting"
          - key: 1
            value: "detection"
          - key: 2
            value: "grid-connected"
          - key: 3
            value: "emergency power supply"
          - key: 4
            value: "recoverable fault"
          - key: 5
            value: "permanent fault"
          - key: 6
            value: "upgrade"
          - key: 7
            value: "self-charging"
        icon: 'mdi:wrench'
      - name: "Room temperature"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x0418 ]
        icon: 'mdi:thermometer'
      - name: "Ambient temperature 2"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x0419 ]
        icon: 'mdi:thermometer'
      - name: "Radiator temperature"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x041A ]
        icon: 'mdi:thermometer'
      - name: "Radiator temperature 2"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x041B ]
        icon: 'mdi:thermometer'
      - name: "Radiator temperature 3"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x041C ]
        icon: 'mdi:thermometer'
      - name: "Radiator temperature 4"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x041D ]
        icon: 'mdi:thermometer'
      - name: "Radiator temperature 5"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x041E ]
        icon: 'mdi:thermometer'
      - name: "Radiator temperature 6"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x041F ]
        icon: 'mdi:thermometer'
      - name: "Module temperature"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x0420 ]
        icon: 'mdi:thermometer'
      - name: "Module temperature 2"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x0421 ]
        icon: 'mdi:thermometer'
      - name: "Module temperature 3"
        class: "temperature"
        uom: "°C"
        scale: 1
        rule: 2
        registers: [ 0x0422 ]
        icon: 'mdi:thermometer'
  - group: InverterDC
    items:
      - name: "PV1 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x0584 ]
        icon: 'mdi:solar-power'
      - name: "PV1 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x0585 ]
        icon: 'mdi:solar-power'
      - name: "PV1 Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [ 0x0586 ]
        icon: 'mdi:solar-power'
      - name: "PV2 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x0587 ]
        icon: 'mdi:solar-power'
      - name: "PV2 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x0588 ]
        icon: 'mdi:solar-power'
      - name: "PV2 Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [ 0x0589 ]
        icon: 'mdi:solar-power'
      - name: "PV3 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x58A ]
        icon: 'mdi:solar-power'
      - name: "PV3 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x58B ]
        icon: 'mdi:solar-power'
      - name: "PV3 Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [ 0x58C ]
        icon: 'mdi:solar-power'
      - name: "PV4 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x58D ]
        icon: 'mdi:solar-power'
      - name: "PV4 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x58E ]
        icon: 'mdi:solar-power'
      - name: "PV4 Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [ 0x58F ]
        icon: 'mdi:solar-power'
  - group: GridAC
    items:
      - name: "Frequency"
        class: "current"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [ 0x0484 ]
        icon: 'mdi:home-lightning-bolt'
      - name: "Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0485 ]
        icon: 'mdi:home-lightning-bolt'
      - name: "ReactivePower_Output_Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0486 ]
        icon: 'mdi:home-lightning-bolt'
      - name: "ApparentPower_Output_Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0487 ]
        icon: 'mdi:home-lightning-bolt'
      - name: "Grid Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0488 ]
        icon: 'mdi:home-lightning-bolt'
      - name: "ReactivePower_PCC_Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0489 ]
        icon: 'mdi:home-lightning-bolt'
      - name: "ApparentPower_PCC_Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x048A ]
        icon: 'mdi:home-lightning-bolt'
      - name: "L1 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x048D ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "L1 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x048E ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_Output_R"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x048F ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ReactivePower_Output_R"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0490 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "PowerFactor_Output_R"
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [ 0x0491 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "Current_PCC_R"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x0492 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_PCC_R"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0493 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ReactivePower_PCC_R"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x0494 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "PowerFactor_PCC_R"
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [ 0x0495 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "L2 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x0498 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "L2 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x0499 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_Output_S"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x049A ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ReactivePower_Output_S"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x049B ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "PowerFactor_Output_S"
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [ 0x049C ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "Current_PCC_S"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x049D ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_PCC_S"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x049E ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ReactivePower_PCC_S"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x049F ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "PowerFactor_PCC_S"
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [ 0x04A0 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "L3 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [ 0x04A3 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "L3 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x04A4 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_Output_T"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x04A5 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ReactivePower_Output_T"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x04A6 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "PowerFactor_Output_T"
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [ 0x04A7 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "Current_PCC_T"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [ 0x04A8 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_PCC_T"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x04A9 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ReactivePower_PCC_T"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x04AA ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "PowerFactor_PCC_T"
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [ 0x04AB ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "ActivePower_PV_Ext"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [ 0x04AE ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "Load Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [ 0x04AF ]
        icon: 'mdi:lightning-bolt-outline'
  - group: Energy
    items:
      - name: "Today Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [ 0x0685,0x0684 ]
        icon: 'mdi:solar-power'
      - name: "Total Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [ 0x0687,0x0686 ]
        icon: 'mdi:solar-power'
      - name: "Today Load Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [ 0x0689,0x0688 ]
        icon: 'mdi:lightning-bolt-outline'
      - name: "Total Load Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [ 0x068B,0x068A ]
        icon: 'mdi:solar-power'
      - name: "Today Energy Import"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [ 0x068D,0x068C ]
        icon: 'mdi:transmission-tower-export'
      - name: "Total Energy Import"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [ 0x068F,0x068E ]
        icon: 'mdi:transmission-tower-export'
      - name: "Today Energy Export"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [ 0x0691,0x0690 ]
        icon: 'mdi:transmission-tower-import'
      - name: "Total Energy Export"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [ 0x0693,0x0692 ]
        icon: 'mdi:transmission-tower-import'
  - group: Alarm
    items:
      - name: "Device Fault"
        class: ""
        state_class: ""
        uom: ""
        scale: 1
        rule: 6
        registers: [ 0x0405,0x0406,0x0407,0x0408,0x0409,0x040A,0x040B,0x040C,0x040D,0x040E,0x040F,0x0410 ]
      - name: "Fault 1"
        class: ""
        state_class: ""
        uom: ""
        scale: 1
        rule: 1
        registers: [ 0x0405 ]
        isstr: true
        icon: 'mdi:wrench'
        lookup:
          - key: 0
            value: "No error"
          - key: 1
            value: "ID01 Grid Over Voltage Protection"
          - key: 2
            value: "ID02 Grid Under Voltage Protection"
          - key: 4
            value: "ID03 Grid Over Frequency Protection"
          - key: 8
            value: "ID04 Grid Under Frequency Protection"
          - key: 16
            value: "ID05 Leakage current fault"
          - key: 32
            value: "ID06 High penetration error"
          - key: 64
            value: "ID07 Low penetration error"
          - key: 128
            value: "ID08 Islanding error"
          - key: 256
            value: "ID09 Grid voltage transient value overvoltage 1"
          - key: 512
            value: "ID10 Grid voltage transient value overvoltage 2"
          - key: 1024
            value: "ID11 Grid line voltage error"
          - key: 2048
            value: "ID12 Inverter voltage error"
          - key: 4096
            value: "ID13 Anti-backflow overload"
          - key: 8192
            value: "ID14"
          - key: 16384
            value: "ID15"
          - key: 32768
            value: "ID16"
      - name: "Fault 2"
        class: ""
        state_class: ""
        uom: ""
        scale: 1
        rule: 1
        icon: 'mdi:wrench'
        isstr: true
        registers: [ 0x0406 ]
        lookup:
          - key: 0
            value: "No error"
          - key: 1
            value: "ID17 Grid current sampling error"
          - key: 2
            value: "ID18 Grid current DC component sampling error (AC side)"
          - key: 4
            value: "ID19 Grid voltage sampling error (DC side)"
          - key: 8
            value: "ID20 Grid voltage sampling error (AC side)"
          - key: 16
            value: "ID21 Leakage current sampling error (DC side)"
          - key: 32
            value: "ID22 Leakage current sampling error (AC side)"
          - key: 64
            value: "ID23 Load voltage DC component sampling error"
          - key: 128
            value: "ID24 DC input current sampling error"
          - key: 256
            value: "ID25 DC component sampling error of grid current (DC side)"
          - key: 512
            value: "ID26 DC input branch current sampling error"
          - key: 1024
            value: "ID27"
          - key: 2048
            value: "ID28"
          - key: 4096
            value: "ID29 Leakage current consistency error"
          - key: 8192
            value: "ID30 Grid voltage consistency error"
          - key: 16384
            value: "ID31 DCI consistency error"
          - key: 32768
            value: "ID32"
      # ... [keeping the rest of the fault definitions as they are]
